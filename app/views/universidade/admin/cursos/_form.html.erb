<%= form_with model: curso,
  url: curso.new_record? ? admin_cursos_path : admin_curso_path(curso),
  data: { turbo_stream: true, action: "turbo:submit-end->modal#close turbo:submit-end->modal#reloadOnSuccess" },
  multipart: true,
  class: "space-y-5" do |f| %>

  <% if curso.errors.any? %>
    <%= alert_component(state: :danger, bordered: true) do |alert| %>
      <% alert.with_title { "#{curso.errors.count} erro(s) impediram o salvamento:" } %>
      <% alert.with_body do %>
        <ul class="list-disc list-inside space-y-1 mt-1">
          <% curso.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      <% end %>
    <% end %>
  <% end %>

  <%# Nome %>
  <div>
    <%= label_component(for: "curso_nome") { "Nome *" } %>
    <%= input_field_component(
          type: "text",
          name: "curso[nome]",
          id: "curso_nome",
          value: curso.nome,
          placeholder: "Ex: Ruby on Rails para iniciantes",
          state: curso.errors[:nome].any? ? :error : :default) %>
    <% if curso.errors[:nome].any? %>
      <%= helper_text_component { curso.errors[:nome].first } %>
    <% end %>
  </div>

  <%# Descrição %>
  <div>
    <%= label_component(for: "curso_descricao") { "Descrição" } %>
    <%= text_area_component(
          name: "curso[descricao]",
          id: "curso_descricao",
          placeholder: "Uma breve descrição do curso…",
          rows: 3) { curso.descricao } %>
  </div>

  <%# Imagem %>
  <div>
    <%= label_component(for: "curso_imagem") { "Imagem do curso" } %>
    <% if curso.imagem.attached? %>
      <div class="mb-3 relative inline-block">
        <%= image_tag main_app.url_for(curso.imagem), class: "w-32 h-32 object-cover rounded-lg border border-gray-200" %>
      </div>
    <% end %>
    <input type="file"
           name="curso[imagem]"
           id="curso_imagem"
           accept="image/*"
           class="block w-full text-sm text-gray-500
                  file:mr-4 file:py-2 file:px-4
                  file:rounded-lg file:border file:border-gray-300
                  file:text-sm file:font-medium
                  file:bg-gray-50 file:text-gray-700
                  hover:file:bg-gray-100
                  cursor-pointer">
    <%= helper_text_component { "Recomendado: imagem quadrada (ex: 800x800px) para melhor visualização." } %>
  </div>

  <%# Tags %>
  <div>
    <%= label_component(for: "curso_tags_text") { "Tags" } %>
    <%= input_field_component(
          type: "text",
          name: "curso[tags_text]",
          id: "curso_tags_text",
          value: curso.tags_text,
          placeholder: "ruby, rails, iniciante") %>
    <%= helper_text_component { "Separe as tags por vírgula." } %>
  </div>

  <%# Visível %>
  <div>
    <input type="hidden" name="curso[visivel]" value="0">
    <%= toggle_component(
          name: "curso[visivel]",
          id: "curso_visivel",
          checked: curso.visivel?,
          checked_value: "1",
          color: :pink) { "Visível para os lojistas" } %>
  </div>

  <div class="flex items-center gap-3 pt-1">
    <input type="hidden" name="curso[status_action]" id="curso_status_action"
           value="<%= curso.new_record? || curso.rascunho? ? 'rascunho' : 'publicar' %>">
    
    <% if curso.publicado? && !curso.new_record? %>
      <%# Curso já publicado: apenas botão Salvar alterações %>
      <button type="submit"
              onclick="document.getElementById('curso_status_action').value='publicar'"
              class="px-4 py-2 text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 rounded-lg transition-colors">
        Salvar alterações
      </button>
    <% else %>
      <%# Curso em rascunho ou novo: botões Salvar rascunho e Publicar %>
      <button type="submit"
              onclick="document.getElementById('curso_status_action').value='rascunho'"
              class="px-4 py-2 text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 rounded-lg transition-colors">
        Salvar rascunho
      </button>
      <button type="submit"
              onclick="document.getElementById('curso_status_action').value='publicar'"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
        Publicar
      </button>
    <% end %>
  </div>

<% end %>
